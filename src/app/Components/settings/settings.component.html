@if (isOn) {
    <div class="fixed inset-0 bg-[var(--overlay-backdrop)] z-50">
        <div class="fixed inset-x-0 top-[64px] lg:top-[10vh] bottom-0 flex justify-center">
            <div class="w-full h-full md:h-[calc(100vh-64px)] lg:h-[calc(100vh-10vh)] md:max-w-[1200px] 
                        bg-[var(--whit-main-background-color)] overflow-y-auto md:rounded-t-xl p-6 md:p-4">
                <h1 class="text-2xl md:text-xl text-[var(--heading-color)] mb-6 font-semibold">
                    {{ 'settings.SETTINGS' | translate }}
                </h1>

                <!-- Navigation - Updated icon sizes -->
                <nav class="grid grid-cols-2 md:flex gap-4 mb-6 border-b border-[var(--border-color)] pb-6 md:pb-4 md:justify-center md:gap-8">
                    <!-- Theme Button -->
                    <button class="w-24 h-24 flex flex-col items-center justify-center p-4 md:p-3 rounded-lg hover:bg-[var(--input-border-color)]" 
                            (click)="changeTab('Theme')">
                        <div class="w-18 h-18 md:w-6 md:h-6 mb-3 md:mb-0 flex items-center justify-center">
                            <svg class="w-18 h-18 sm:w-6 sm:h-6 min-h-[48px] min-w-[48px] sm:max-h-[24px] sm:max-w-[24px]" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.192"></g><g id="SVGRepo_iconCarrier"> <path d="M15.5 8.5H15.51M10.5 7.5H10.51M7.5 11.5H7.51M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 13.6569 19.6569 15 18 15H17.4C17.0284 15 16.8426 15 16.6871 15.0246C15.8313 15.1602 15.1602 15.8313 15.0246 16.6871C15 16.8426 15 17.0284 15 17.4V18C15 19.6569 13.6569 21 12 21ZM16 8.5C16 8.77614 15.7761 9 15.5 9C15.2239 9 15 8.77614 15 8.5C15 8.22386 15.2239 8 15.5 8C15.7761 8 16 8.22386 16 8.5ZM11 7.5C11 7.77614 10.7761 8 10.5 8C10.2239 8 10 7.77614 10 7.5C10 7.22386 10.2239 7 10.5 7C10.7761 7 11 7.22386 11 7.5ZM8 11.5C8 11.7761 7.77614 12 7.5 12C7.22386 12 7 11.77614 7 11.5C7 11.2239 7.22386 11 7.5 11C7.7761 11 8 11.2239 8 11.5Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                        </div>
                        <span class="text-base md:hidden">Theme</span>
                    </button>

                    <!-- Language Button -->
                    <button class="w-24 h-24 flex flex-col items-center justify-center p-4 md:p-3 rounded-lg hover:bg-[var(--input-border-color)]" 
                            (click)="changeTab('Language')">
                        <div class="w-18 h-18 md:w-6 md:h-6 mb-3 md:mb-0 flex items-center justify-center">
                            <svg class="w-18 h-18 sm:w-6 sm:h-6 min-h-[48px] min-w-[48px] sm:max-h-[24px] sm:max-w-[24px]" viewBox="0 0 32 32" fill="#000000" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M32.032 16c0-8.501-6.677-15.472-15.072-15.969-0.173-0.019-0.346-0.032-0.523-0.032-0.052 0-0.104 0.005-0.156 0.007-0.093-0.002-0.186-0.007-0.281-0.007-8.84 0-16.032 7.178-16.032 16.001s7.192 16.001 16.032 16.001c0.094 0 0.188-0.006 0.281-0.008 0.052 0.002 0.104 0.008 0.156 0.008 0.176 0 0.349-0.012 0.523-0.032 8.395-0.497 15.072-7.468 15.072-15.969zM29.049 21.151c-0.551-0.16-1.935-0.507-4.377-0.794 0.202-1.381 0.313-2.84 0.313-4.357 0-1.196-0.069-2.354-0.197-3.469 3.094-0.37 4.45-0.835 4.54-0.867l-0.372-1.050c0.695 1.659 1.080 3.478 1.080 5.386 0 1.818-0.352 3.555-0.987 5.151zM8.921 16c0-1.119 0.074-2.212 0.21-3.263 1.621 0.127 3.561 0.222 5.839 0.243v6.939c-2.219 0.021-4.114 0.111-5.709 0.234-0.22-1.319-0.34-2.715-0.34-4.154zM16.967 2.132c2.452 0.711 4.552 4.115 5.492 8.628-1.512 0.12-3.332 0.209-5.492 0.229v-8.857zM14.971 2.156v8.832c-2.136-0.021-3.965-0.109-5.502-0.226 0.96-4.457 3.076-7.836 5.502-8.606zM14.971 21.913l0 7.929c-2.263-0.718-4.256-3.705-5.293-7.719 1.492-0.11 3.253-0.189 5.292-0.21zM16.967 29.868l-0-7.955c2.061 0.020 3.814 0.102 5.288 0.217-1.019 4.067-3 7.076-5.288 7.738zM16.967 19.92l0-6.939c2.291-0.021 4.218-0.118 5.818-0.25 0.131 1.053 0.203 2.147 0.203 3.268 0 1.442-0.116 2.84-0.329 4.16-1.575-0.128-3.462-0.219-5.692-0.24zM28.588 9.81c-0.302 0.094-1.564 0.453-4.094 0.751-0.564-2.998-1.584-5.561-2.91-7.412 3.048 1.325 5.535 3.697 7.005 6.661zM11.213 2.831c-1.632 1.873-2.963 4.568-3.691 7.754-2.265-0.245-3.623-0.534-4.166-0.665 1.585-3.27 4.407-5.836 7.856-7.088zM2.614 11.787c0.385 0.104 1.841 0.467 4.549 0.766-0.155 1.107-0.24 2.26-0.24 3.447 0 1.509 0.136 2.96 0.383 4.334-2.325 0.251-3.755 0.552-4.396 0.706-0.607-1.566-0.944-3.264-0.944-5.041 0-1.467 0.228-2.883 0.649-4.213zM3.784 22.886c0.727-0.154 2.029-0.39 3.956-0.591 0.759 2.803 1.993 5.175 3.473 6.874-3.16-1.148-5.79-3.398-7.429-6.282v0zM21.583 28.849c1.195-1.665 2.14-3.907 2.728-6.525 1.982 0.227 3.226 0.494 3.853 0.652-1.5 2.596-3.808 4.669-6.581 5.873z"></path> </g></svg>
                        </div>
                        <span class="text-base md:hidden">Language</span>
                    </button>

                    <!-- Account Button -->
                    <button class="w-24 h-24 flex flex-col items-center justify-center p-4 md:p-3 rounded-lg hover:bg-[var(--input-border-color)]" 
                            (click)="changeTab('Account')">
                        <div class="w-18 h-18 md:w-6 md:h-6 mb-3 md:mb-0 flex items-center justify-center">
                            <svg class="w-18 h-18 sm:w-6 sm:h-6 min-h-[48px] min-w-[48px] sm:max-h-[24px] sm:max-w-[24px]" viewBox="0 0 100 100" fill="#000000" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 100 100" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path d="M80.161,60.441l-15.66-7.47l-6.622-3.159c2.892-1.822,5.241-4.634,6.778-8.022c1.22-2.69,1.946-5.734,1.946-8.99 c0-1.827-0.29-3.562-0.694-5.236C63.94,19.453,57.605,13.477,50,13.477c-7.461,0-13.701,5.763-15.792,13.645 c-0.482,1.808-0.815,3.688-0.815,5.68c0,3.459,0.808,6.684,2.181,9.489c1.587,3.254,3.94,5.937,6.804,7.662l-6.342,2.953 l-16.168,7.53c-1.404,0.658-2.327,2.242-2.327,4.011v15.062v2.703c0,2.381,1.659,4.312,3.708,4.312h57.505 c2.048,0,3.708-1.93,3.708-4.312v-2.703V64.446C82.46,62.683,81.552,61.114,80.161,60.441z"></path> </g> </g></svg>
                        </div>
                        <span class="text-base md:hidden">Account</span>
                    </button>

                    <!-- Activity Button -->
                    <button class="w-24 h-24 flex flex-col items-center justify-center p-4 md:p-3 rounded-lg hover:bg-[var(--input-border-color)]" 
                            (click)="changeTab('activity')">
                        <div class="w-18 h-18 md:w-6 md:h-6 mb-3 md:mb-0 flex items-center justify-center">
                            <svg class="w-18 h-18 sm:w-6 sm:h-6 min-h-[48px] min-w-[48px] sm:max-h-[24px] sm:max-w-[24px]" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7 14L8.8 11.8C9.5 11 9.9 10.6 10.3 10.6C10.8 10.6 11.2 11 11.9 11.8L12.1 12.2C12.8 13 13.2 13.4 13.7 13.4C14.1 13.4 14.5 13 15.2 12.2L17 10" 
                                      stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                <path d="M22 12C22 16.7 22 19.1 20.5 20.5C19.1 22 16.7 22 12 22C7.3 22 4.9 22 3.5 20.5C2 19.1 2 16.7 2 12C2 7.3 2 4.9 3.5 3.5C4.9 2 7.3 2 12 2C16.7 2 19.1 2 20.5 3.5C21.5 4.4 21.8 5.8 21.9 8" 
                                      stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <span class="text-base md:hidden">Activity</span>
                    </button>
                </nav>

                <!-- Content sections - Improved mobile accessibility -->
                @switch (settingsTab) {
                    @case ("Theme") {
                        <section class="py-6 md:py-3">
                            <article class="space-y-4 md:space-y-2">
                                <label for="themeChange" class="block text-lg md:text-base text-[var(--heading-color)] font-medium">
                                    {{ 'settings.THEMECHANGE' | translate }}
                                </label>
                                <select id="themeChange" 
                                        class="w-full p-4 md:p-2 text-lg md:text-sm border border-[var(--border-color)] rounded-lg md:rounded-md"
                                        [(ngModel)]="themeValue" 
                                        (change)="switchTheme(themeValue)">
                                    <option class="bg-[var(--section-background)]" value="light">{{ 'settings.LIGHTTHEME' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="dark">{{ 'settings.DARKTHEME' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="sepia">{{'settings.SEPIATHEME' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="forest">{{'settings.FORESTTHEME' | translate}}</option>
                                    <option class="bg-[var(--section-background)]" value="ocean">{{'settings.OCEANTHEME' | translate}}</option>
                                    <option class="bg-[var(--section-background)]" value="lavender">{{'settings.LAVENDERTHEME' | translate}}</option>
                                </select>    
                            </article>
                        </section>
                        <button class="w-full md:w-auto py-4 md:py-2 px-6 md:px-4 text-lg md:text-sm bg-[var(--button-background-color)] text-[var(--button-color)] rounded-lg">
                            {{ 'settings.SAVE' | translate }}
                        </button>
                    }
                    @case ("Language") {
                        <section class="py-3">
                            <article>
                                <label for="languageChange" class="block mb-2 text-black font-medium text-base">{{ 'settings.LANGUAGECHANGE' | translate }}</label>
                                <select id="languageChange" class="w-full p-2 border border-[var(--border-color)] rounded-md text-sm transition-all focus:outline-none focus:border-[var(--button-background-color)] focus:ring-2 focus:ring-[var(--button-background-color-hover)]" [(ngModel)]="languageValue" (change)="switchLanguage(languageValue)">
                                    <option class="bg-[var(--section-background)]" value="en">{{ 'settings.ENGLISH' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="pl">{{ 'settings.POLISH' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="es">{{ 'settings.SPANISH' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="ge">{{ 'settings.GERMAN' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="pt">{{ 'settings.PORTUGESE' | translate }}</option>
                                    <option class="bg-[var(--section-background)]" value="fr">{{ 'settings.BAGUETTE' | translate}}</option>
                                </select>
                            </article>
                        </section>
                        <button class="w-full sm:w-auto bg-[var(--button-background-color)] text-[var(--button-color)] border-none py-2 px-4 rounded-md cursor-pointer transition-colors hover:bg-[var(--button-background-color-hover)] font-medium text-sm" (click)="saveUserPeferences()">{{ 'settings.SAVE' | translate }}</button>
                    }
                    @case ("Account") {
                        <section class="flex flex-col gap-4">
                            <form class="flex-1 flex flex-col gap-4 border border-[var(--border-color)] shadow-md p-4 max-h-[70vh] overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]">
                                <h3 class="text-lg font-semibold">{{'settings.USERCONFIG' | translate}}</h3>
                                <article>
                                    <label for="nameChange" class="block mb-2 text-black font-medium text-base">{{ 'settings.CHANGENAME' | translate }}</label>
                                    <input type="text" id="nameChange" name="change name" class="w-full p-2 border border-[var(--border-color)] rounded-md text-sm transition-all focus:outline-none focus:border-[var(--button-background-color)] focus:ring-2 focus:ring-[var(--button-background-color-hover)]" [(ngModel)]="name">
                                </article>
                                <article>
                                    <label for="emailVisibility" class="block mb-2 text-black font-medium text-base">{{ 'settings.CHANGEVISIBILITY' | translate }}</label>
                                    <input type="checkbox" id="emailVisibility" name="user emailVisibility" class="w-4 h-4 text-[var(--button-background-color)] border-[var(--border-color)] rounded focus:ring-[var(--button-background-color)]" [(ngModel)]="emailVisibility">
                                </article>
                                <article>
                                    <label for="avatar" class="block mb-2 text-black font-medium text-base">{{'settings.CHANGEAVATAR' | translate}}</label>
                                    <input type="file" name="user avatar" id="avatar" class="w-full p-2 border border-[var(--border-color)] rounded-md text-sm transition-all focus:outline-none focus:border-[var(--button-background-color)] focus:ring-2 focus:ring-[var(--button-background-color-hover)]" (change)="onFileSelected($event)" accept="image/*">
                                </article>
                                <button class="w-full bg-[var(--button-background-color)] text-[var(--button-color)] border-none py-2 px-4 rounded-md cursor-pointer transition-colors hover:bg-[var(--button-background-color-hover)] font-medium text-sm" (click)="updateUser($event)">{{ 'settings.SAVECHANGES' | translate }}</button>
                            </form>
                            <form class="flex-1 flex flex-col gap-4 border border-[var(--border-color)] shadow-md p-4 max-h-[70vh] overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]">
                                <h3 class="text-lg font-semibold">{{'settings.PASSWORDCHNAGE' | translate}}</h3>
                                <article>
                                    <label for="passwordChange" class="block mb-2 text-black font-medium text-base">{{ 'settings.CHANGEPASSWORD' | translate }}</label>
                                    <input type="password" id="passwordChange" name="old password" class="w-full p-2 border border-[var(--border-color)] rounded-md text-sm transition-all focus:outline-none focus:border-[var(--button-background-color)] focus:ring-2 focus:ring-[var(--button-background-color-hover)]" [(ngModel)]="password"/>
                                </article>
                                <article>
                                    <label for="oldPassword" class="block mb-2 text-black font-medium text-base">{{ 'settings.OLDPASSWORD' | translate }}</label>
                                    <input type="password" id="oldPassword" name="old password" class="w-full p-2 border border-[var(--border-color)] rounded-md text-sm transition-all focus:outline-none focus:border-[var(--button-background-color)] focus:ring-2 focus:ring-[var(--button-background-color-hover)]" [(ngModel)]="oldPassword" />
                                </article>
                                <button class="w-full bg-[var(--button-background-color)] text-[var(--button-color)] border-none py-2 px-4 rounded-md cursor-pointer transition-colors hover:bg-[var(--button-background-color-hover)] font-medium text-sm" (click)="updatePassword($event)">{{ 'settings.CHANGEPASSWORDCONFIRM' | translate }}</button>
                            </form>
                        </section>
                    }
                    @case ('activity') {
                        <section class="py-3">
                            <h2 class="text-lg font-semibold mb-3">{{ 'settings.USERACTIVITY' | translate }}</h2>
                            <article class="flex flex-wrap gap-0.5">
                                @for (day of daysArray; track $index) {
                                    <div class="w-[30px] h-[30px] m-0.5 rounded inline-block"
                                         [ngClass]="{
                                            'bg-[var(--activity-none)]': day.count === 0,
                                            'bg-[var(--activity-low)]': day.count > 0 && day.count <= 3,
                                            'bg-[var(--activity-medium)]': day.count > 3 && day.count <= 6,
                                            'bg-[var(--activity-high)]': day.count > 6
                                         }"
                                         [title]="day.count + ' activities on ' + (day.date | date)">
                                    </div>
                                }
                            </article>
                        </section>
                    }
                }         
            </div>
        </div>
    </div>
}

<!-- Settings toggle button -->
<button class="fixed bottom-4 right-4 bg-[var(--whit-main-background-color)] rounded-full p-3 md:p-2 shadow-md z-[60]" 
        (click)="showSettings()">
    <svg class="w-8 h-8 sm:w-6 sm:h-6 min-h-[60px] min-w-[60px] sm:max-h-[20px] sm:max-w-[20px] cursor-pointer transition-transform hover:rotate-90" viewBox="-51.2 -51.2 614.40 614.40" xml:space="preserve" fill="#000000" stroke="#000000" stroke-width="0.00512" transform="rotate(0)matrix(1, 0, 0, 1, 0, 0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <style type="text/css">  .st0{fill:#000000;}  </style> <g> <path class="st0" d="M496,293.984c9.031-0.703,16-8.25,16-17.297v-41.375c0-9.063-6.969-16.594-16-17.313l-54.828-4.281 c-3.484-0.266-6.484-2.453-7.828-5.688l-18.031-43.516c-1.344-3.219-0.781-6.906,1.5-9.547l35.75-41.813 c5.875-6.891,5.5-17.141-0.922-23.547l-29.25-29.25c-6.406-6.406-16.672-6.813-23.547-0.922l-41.813,35.75 c-2.641,2.266-6.344,2.844-9.547,1.516l-43.531-18.047c-3.219-1.328-5.422-4.375-5.703-7.828l-4.266-54.813 C293.281,6.969,285.75,0,276.688,0h-41.375c-9.063,0-16.594,6.969-17.297,16.016l-4.281,54.813c-0.266,3.469-2.469,6.5-5.688,7.828 l-43.531,18.047c-3.219,1.328-6.906,0.75-9.563-1.516l-41.797-35.75c-6.875-5.891-17.125-5.484-23.547,0.922l-29.25,29.25 c-6.406,6.406-6.797,16.656-0.922,23.547l35.75,41.813c2.25,2.641,2.844,6.328,1.5,9.547l-18.031,43.516 c-1.313,3.234-4.359,5.422-7.813,5.688L16,218c-9.031,0.719-16,8.25-16,17.313v41.359c0,9.063,6.969,16.609,16,17.313l54.844,4.266 c3.453,0.281,6.5,2.484,7.813,5.703l18.031,43.516c1.344,3.219,0.75,6.922-1.5,9.563l-35.75,41.813 c-5.875,6.875-5.484,17.125,0.922,23.547l29.25,29.25c6.422,6.406,16.672,6.797,23.547,0.906l41.797-35.75 c2.656-2.25,6.344-2.844,9.563-1.5l43.531,18.031c3.219,1.344,5.422,4.359,5.688,7.844l4.281,54.813 c0.703,9.031,8.234,16.016,17.297,16.016h41.375c9.063,0,16.594-6.984,17.297-16.016l4.266-54.813 c0.281-3.484,2.484-6.5,5.703-7.844l43.531-18.031c3.203-1.344,6.922-0.75,9.547,1.5l41.813,35.75 c6.875,5.891,17.141,5.5,23.547-0.906l29.25-29.25c6.422-6.422,6.797-16.672,0.922-23.547l-35.75-41.813 c-2.25-2.641-2.844-6.344-1.5-9.563l18.031-43.516c1.344-3.219,4.344-5.422,7.828-5.703L496,293.984z M256,342.516 c-23.109,0-44.844-9-61.188-25.328c-16.344-16.359-25.344-38.078-25.344-61.203c0-23.109,9-44.844,25.344-61.172 c16.344-16.359,38.078-25.344,61.188-25.344c23.125,0,44.844,8.984,61.188,25.344c16.344,16.328,25.344,38.063,25.344,61.172 c0,23.125-9,44.844-25.344,61.203C300.844,333.516,279.125,342.516,256,342.516z"></path> </g></g></svg>
</button>
